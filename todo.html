<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/pickr.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/classic.min.css">
</head>
<style>/* Mobile styles */
    @media (max-width: 640px) {
        body {
            font-size: 16px;
        }
    
        .task-card {
            padding: 12px; 
            margin: 8px 0; 
            border-radius: 8px; 
        }
    
        button {
            padding: 12px 16px; 
            font-size: 18px; 
        }
    
        .nav-bar {
            display: flex;
            justify-content: space-around;
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: white;
            border-top: 1px solid #ccc;
        }
    
        .task-input {
            width: 100%;
            margin: 8px 0; 
        }
    }</style>
<div id="helpModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-[100] p-4">
    <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 overflow-hidden">
        <div id="helpModalContent" class="relative w-full h-full">
            <div class="help-page active" data-page="1">
                <div class="grid md:grid-cols-2 h-full">
                    <div class="bg-gradient-to-br from-blue-500 to-purple-600 p-8 flex flex-col justify-center text-white">
                        <h2 class="text-4xl font-bold mb-4">Welcome to TaskMaster</h2>
                        <p class="text-xl mb-6">Your ultimate productivity companion designed to transform how you manage tasks and achieve goals.</p>
                        <div class="flex items-center space-x-4">
                            <div class="bg-white/20 p-3 rounded-full">
                                <i data-feather="check-circle" class="w-12 h-12 text-white"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-xl">Streamline Your Workflow</h3>
                                <p class="text-white/80">Effortlessly organize, prioritize, and track your tasks.</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-8 flex flex-col justify-center">
                        <div class="text-center">
                            <lottie-player 
                                src="https://assets2.lottiefiles.com/packages/lf20_UJNc2t.json"  
                                background="transparent"  
                                speed="1"  
                                style="width: 300px; height: 300px; margin: 0 auto;"  
                                loop  
                                autoplay>
                            </lottie-player>
                            <h3 class="text-2xl font-bold mb-4">Ready to Boost Productivity?</h3>
                            <p class="mb-6 text-gray-600">Let's explore the powerful features of TaskMaster</p>
                            <button onclick="changeHelpPage(2)" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-full transition duration-300 transform hover:scale-105">
                                Get Started
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page 2: Key Features -->
            <div class="help-page hidden" data-page="2">
                <div class="p-8">
                    <h2 class="text-4xl font-bold text-center mb-8 text-gray-800">Key Features</h2>
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="bg-blue-50 p-6 rounded-lg text-center hover:shadow-lg transition-all duration-300">
                            <div class="mb-4 flex justify-center">
                                <i data-feather="plus-circle" class="w-16 h-16 text-blue-500"></i>
                            </div>
                            <h3 class="font-semibold text-2xl mb-4 text-gray-800">Task Creation</h3>
                            <ul class="space-y-2 text-gray-600">
                                <li>Detailed task input</li>
                                <li>Priority levels</li>
                                <li>Due date tracking</li>
                            </ul>
                        </div>

                        <div class="bg-green-50 p-6 rounded-lg text-center hover:shadow-lg transition-all duration-300">
                            <div class="mb-4 flex justify-center">
                                <i data-feather="layers" class="w-16 h-16 text-green-500"></i>
                            </div>
                            <h3 class="font-semibold text-2xl mb-4 text-gray-800">Subtask Management</h3>
                            <ul class="space-y-2 text-gray-600">
                                <li>Break down complex tasks</li>
                                <li>Individual tracking</li>
                                <li>Progress visualization</li>
                            </ul>
                        </div>

                        <div class="bg-purple-50 p-6 rounded-lg text-center hover:shadow-lg transition-all duration-300">
                            <div class="mb-4 flex justify-center">
                                <i data-feather="tool" class="w-16 h-16 text-purple-500"></i>
                            </div>
                            <h3 class="font-semibold text-2xl mb-4 text-gray-800">Advanced Options</h3>
                            <ul class="space-y-2 text-gray-600">
                                <li>Color coding</li>
                                <li>Difficulty rating</li>
                                <li>Clipboard export</li>
                            </ul>
                        </div>
                    </div>
                    <div class="flex justify-between mt-8">
                        <button onclick="changeHelpPage(1)" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-8 rounded-full transition duration-300">
                            Previous
                        </button>
                        <button onclick="changeHelpPage(3)" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-full transition duration-300 transform hover:scale-105">
                            Continue
                        </button>
                    </div>
                </div>
            </div>

            <!-- Page 3: Getting Started -->
            <div class="help-page hidden" data-page="3">
                <div class="p-8 text-center">
                    <h2 class="text-4xl font-bold mb-6 text-gray-800">Quick Start Guide</h2>
                    <div class="max-w-4xl mx-auto grid md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-blue-50 p-6 rounded-lg hover:shadow-lg transition-all duration-300">
                            <div class="mb-4 flex justify-center">
                                <i data-feather="plus-circle" class="w-16 h-16 text-blue-500"></i>
                            </div>
                            <h3 class="font-semibold text-2xl mb-4 text-gray-800">Create Tasks</h3>
                            <ul class="space-y-2 text-gray-600">
                                <li>Click "Add Task"</li>
                                <li>Enter task title</li>
                                <li>Add optional details</li>
                                <li>Set priority and due date</li>
                            </ul>
                        </div>

                        <div class="bg-green-50 p-6 rounded-lg hover:shadow-lg transition-all duration-300">
                            <div class="mb-4 flex justify-center">
                                <i data-feather="edit" class="w-16 h-16 text-green-500"></i>
                            </div>
                            <h3 class="font-semibold text-2xl mb-4 text-gray-800">Manage Tasks</h3>
                            <ul class="space-y-2 text-gray-600">
                                <li>Edit tasks easily</li>
                                <li>Delete unwanted tasks</li>
                                 <li>Add subtasks</li>
                                <li>Use color coding</li>
                            </ul>
                        </div>

                        <div class="bg-purple-50 p-6 rounded-lg hover:shadow-lg transition-all duration-300">
                            <div class="mb-4 flex justify-center">
                                <i data-feather="trending-up" class="w-16 h-16 text-purple-500"></i>
                            </div>
                            <h3 class="font-semibold text-2xl mb-4 text-gray-800">Boost Productivity</h3>
                            <ul class="space-y-2 text-gray-600">
                                <li>Sort tasks</li>
                                <li>Set difficulty levels</li>
                                <li>Track your progress</li>
                                <li>Export task details</li>
                            </ul>
                        </div>
                    </div>

                    <div class="flex justify-between max-w-xl mx-auto">
                        <button onclick="changeHelpPage(2)" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-8 rounded-full transition duration-300">
                            Previous
                        </button>
                        <button id="closeHelpModal" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-full transition duration-300 transform hover:scale-105">
                            Start Using TaskMaster
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<button id="helpButton" class="fixed bottom-4 left-4 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full flex items-center justify-center">
    <i data-feather="help-circle" class="w-6 h-6"></i>
</button>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto p-4 max-w-3xl">
        <h1 class="text-4xl font-bold mb-6 text-center text-gray-800">To-Do</h1>
        <div class="mb-4">
            <label for="sortTasks" class="block text-sm font-medium text-gray-700">Sort by:</label>
            <select id="sortTasks" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                <option value="default">Default</option>
                <option value="priorityDesc">Priority (High to Low)</option>
                <option value="priorityAsc">Priority (Low to High)</option>
                <option value="dueDateAsc">Due Date (Earliest First)</option>
                <option value="dueDateDesc">Due Date (Latest First)</option>
                <option value="difficultyDesc">Difficulty (Highest First)</option>
                <option value="difficultyAsc">Difficulty (Lowest First)</option>
                <option value="titleAsc">Title (A-Z)</option>
                <option value="titleDesc">Title (Z-A)</option>
                <option value="subtaskCountDesc">Subtask Count (Most First)</option>
                <option value="subtaskCountAsc">Subtask Count (Least First)</option>
            </select>
        </div>

        <form id="taskForm" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <div class="mb-4">
                <input type="text" id="taskTitle" placeholder="Task Title" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>
            <div class="mb-4">
                <button type="button" id="toggleOptional" class="text-blue-500 hover:text-blue-700 focus:outline-none">
                    <i data-feather="chevron-down"></i> Optional Fields
                </button>
            </div>
            <div id="optionalFields" class="hidden space-y-4">
                <div>
                    <textarea id="taskDesc" placeholder="Task Description" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"></textarea>
                </div>
                <div class="flex space-x-4">
                    <div class="w-1/3">
                        <select id="taskPriority" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                            <option value="">Priority</option>
                            <option value="Low">Low</option>
                            <option value="Medium">Medium</option>
                            <option value="High">High</option>
                        </select>
                    </div>
                    <div class="w-1/3">
                        <input type="text" id="taskDueDate" placeholder="Due Date" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    </div>
                    <div class="w-1/3">
                        <select id="taskDifficulty" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                            <option value="">Difficulty</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>
                </div>
                <div>
                    <div id="color-picker"></div>
                </div>

            </div>
            <div class="flex items-center justify-between mt-4">
                <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                    Add Task
                </button>
            </div>
        </form>

        <div id="taskList" class="space-y-4"></div>
    </div>

    <template id="subtaskTemplate">
        <div class="subtask-item bg-gray-50 p-4 rounded">
            <div class="grid grid-cols-2 gap-4">
                <input type="text" class="subtask-title shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" placeholder="Subtask Title">
                <textarea class="subtask-desc shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" placeholder="Subtask Description"></textarea>
            </div>
            <div class="grid grid-cols-3 gap-4 mt-2">
                <select class="subtask-priority shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    <option value="">Priority</option>
                    <option value="Low">Low</option>
                    <option value="Medium">Medium</option>
                    <option value="High">High</option>
                </select>
                <input type="text" class="subtask-due-date shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" placeholder="Due Date">
                <select class="subtask-difficulty shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    <option value="">Difficulty</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </div>
            <div class="flex justify-end mt-2">
                <button type="button" onclick="removeSubtask(this)" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
                    Remove Subtask
                </button>
            </div>
        </div>
    </template>

    <script>

        let tasks = [];
        let pickr;
        function changeHelpPage(page) {
            const pages = document.querySelectorAll('.help-page');
            pages.forEach(p => p.classList.add('hidden'));
            document.querySelector(`.help-page[data-page="${page}"]`).classList.remove('hidden');
        }
        document.addEventListener('DOMContentLoaded', function() {
            feather.replace();
            setupAutoRefresh();

            document.getElementById('sortTasks').addEventListener('change', function() {
                renderTasks();

            });

            const taskForm = document.getElementById('taskForm');
            const taskList = document.getElementById('taskList');
            const toggleOptional = document.getElementById('toggleOptional');
            const optionalFields = document.getElementById('optionalFields');

            tasks = JSON.parse(localStorage.getItem('tasks')) || [];

            flatpickr("#taskDueDate", {
                dateFormat: "Y-m-d",
                minDate: "today"
            });

            pickr = Pickr.create({
                el: '#color-picker',
                theme: 'classic',
                default: '#ffffff',
                swatches: [
                    '#ffffff', '#ff0000', '#00ff00', '#0000ff', 
                    '#ffff00', '#ff00ff', '#00ffff'
                ],
                components: {
                    preview: true,
                    opacity: true,
                    hue: true,
                    interaction: {
                        hex: true,
                        rgba: true,
                        input: true,
                        clear: true,
                        save: true
                    }
                }
            });

            toggleOptional.addEventListener('click', function() {
                optionalFields.classList.toggle('hidden');
                const icon = toggleOptional.querySelector('i');
                icon.setAttribute('data-feather', optionalFields.classList.contains('hidden') ? 'chevron-down' : 'chevron-up');
                feather.replace();
            });

            taskForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const taskTitle = document.getElementById('taskTitle').value;
                const taskDesc = document.getElementById('taskDesc').value;
                const taskPriority = document.getElementById('taskPriority').value;
                const taskDueDate = document.getElementById('taskDueDate').value;
                const taskDifficulty = document.getElementById('taskDifficulty').value;
                const taskColor = pickr.getColor().toHEXA().toString();

                const subtaskElements = document.querySelectorAll('.subtask-item');
                const subtasks = Array.from(subtaskElements).map(element => ({
                    title: element.querySelector('.subtask-title').value,
                    description: element.querySelector('.subtask-desc').value,
                    priority: element.querySelector('.subtask-priority').value,
                    dueDate: element.querySelector('.subtask-due-date').value,
                    difficulty: element.querySelector('.subtask-difficulty').value,
                    completed: false
                }));

                const newTask = {
                    title: taskTitle,
                    description: taskDesc,
                    priority: taskPriority,
                    dueDate: taskDueDate,
                    difficulty: taskDifficulty,
                    color: taskColor,
                    status: 'Pending',
                    subtasks: subtasks
                };

                tasks.push(newTask);
                localStorage.setItem('tasks', JSON.stringify(tasks));
                renderTasks();
                taskForm.reset();
                document.getElementById('subtasksList').innerHTML = '';
                pickr.setColor('#ffffff');
            });

            renderTasks();
        });
        function removeTask(index) {
            if (confirm('Are you sure you want to delete this task?')) {
                tasks.splice(index, 1);
                localStorage.setItem('tasks', JSON.stringify(tasks));
                renderTasks();
            }
        }
        document.getElementById('helpButton').addEventListener('click', function() {
            document.getElementById('helpModal').classList.remove('hidden');
        });
    
        document.getElementById('closeHelpModal').addEventListener('click', function() {
            document.getElementById('helpModal').classList.add('hidden');
        });
        function sortTasks(sortBy) {
            const priorityOrder = { 'High': 3, 'Medium': 2, 'Low': 1, '': 0 };

            return tasks.sort((a, b) => {
                switch (sortBy) {
                    case 'priorityDesc':
                        return priorityOrder[b.priority] - priorityOrder[a.priority];
                    case 'priorityAsc':
                        return priorityOrder[a.priority] - priorityOrder[b.priority];
                    case 'dueDateAsc':
                        return new Date(a.dueDate || '9999-12-31') - new Date(b.dueDate || '9999-12-31');
                    case 'dueDateDesc':
                        return new Date(b.dueDate || '1970-01-01') - new Date(a.dueDate || '1970-01-01');
                    case 'difficultyDesc':
                        return (b.difficulty || 0) - (a.difficulty || 0);
                    case 'difficultyAsc':
                        return (a.difficulty || 0) - (b.difficulty || 0);
                    case 'titleAsc':
                        return a.title.localeCompare(b.title);
                    case 'titleDesc':
                        return b.title.localeCompare(a.title);
                    case 'createdAsc':
                        return (a.createdAt || 0) - (b.createdAt || 0);
                    case 'createdDesc':
                        return (b.createdAt || 0) - (a.createdAt || 0);
                    case 'subtaskCountDesc':
                        return (b.subtasks?.length || 0) - (a.subtasks?.length || 0);
                    case 'subtaskCountAsc':
                        return (a.subtasks?.length || 0) - (b.subtasks?.length || 0);
                    default:
                        return 0;
                }
            });
        }

        function editTask(index) {
            const task = tasks[index];

            const dialog = document.createElement('div');
            dialog.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center';
            dialog.innerHTML = `
                <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full">
                    <h3 class="text-xl font-bold mb-4">Edit Task</h3>
                    <form id="editTaskForm" class="space-y-4">
                        <div>
                            <input type="text" id="editTitle" value="${task.title}" required
                                class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <textarea id="editDesc" 
                                class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">${task.description || ''}</textarea>
                        </div>
                        <div class="grid grid-cols-3 gap-4">
                            <select id="editPriority" class="w-full p-2 border rounded">
                                <option value="">Priority</option>
                                <option value="Low" ${task.priority === 'Low' ? 'selected' : ''}>Low</option>
                                <option value="Medium" ${task.priority === 'Medium' ? 'selected' : ''}>Medium</option>
                                <option value="High" ${task.priority === 'High' ? 'selected' : ''}>High</option>
                            </select>
                            <input type="text" id="editDueDate" value="${task.dueDate || ''}" 
                                class="w-full p-2 border rounded edit-due-date">
                            <select id="editDifficulty" class="w-full p-2 border rounded">
                                <option value="">Difficulty</option>
                                ${[1, 2, 3, 4, 5].map(num => 
                                    `<option value="${num}" ${task.difficulty == num ? 'selected' : ''}>${num}</option>`
                                ).join('')}
                            </select>
                        </div>
                        <div>
                            <div id="editColorPicker"></div>
                        </div>
                        <div class="flex justify-end space-x-2 mt-4">
                            <button type="button" onclick="this.closest('.fixed').remove()" 
                                class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
                            <button type="submit" 
                                class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Save Changes</button>
                        </div>
                    </form>
                </div>
            `;

            document.body.appendChild(dialog);

            flatpickr(".edit-due-date", {
                dateFormat: "Y-m-d",
                minDate: "today"
            });

            const editPickr = Pickr.create({
                el: '#editColorPicker',
                theme: 'classic',
                default: task.color || '#ffffff',
                swatches: [
                    '#ffffff', '#ff0000', '#00ff00', '#0000ff', 
                    '#ffff00', '#ff00ff', '#00ffff'
                ],
                components: {
                    preview: true,
                    opacity: true,
                    hue: true,
                    interaction: {
                        hex: true,
                        rgba: true,
                        input: true,
                        clear: true,
                        save: true
                    }
                }
            });

            dialog.querySelector('#editTaskForm').addEventListener('submit', (e) => {
                e.preventDefault();

                tasks[index] = {
                    ...task, 
                    title: document.getElementById('editTitle').value,
                    description: document.getElementById('editDesc').value,
                    priority: document.getElementById('editPriority').value,
                    dueDate: document.getElementById('editDueDate').value,
                    difficulty: document.getElementById('editDifficulty').value,
                    color: editPickr.getColor().toHEXA().toString()
                };

                localStorage.setItem('tasks', JSON.stringify(tasks));
                renderTasks();
                dialog.remove();
            });
        }
        function copyTask(index) { const content = JSON.stringify(tasks[index], null, 2); navigator.clipboard.writeText(content).then(() => { console.log('Copied to clipboard:', content); showNotification('Task copied to clipboard! ', 'success'); }).catch(err => { console.error('Failed to copy:', err); showNotification('Failed to copy task', 'error'); }); }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded shadow-lg ${type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }
        function renderTasks() {
            const sortBy = document.getElementById('sortTasks').value;
            sortTasks(sortBy);
        
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';
        
            tasks.forEach((task, index) => {
                const taskItem = document.createElement('div');
                taskItem.className = `bg-white p-6 rounded shadow mb-4 ${task.isRecommended ? 'border-2 border-purple-300 bg-purple-50' : ''}`;
                taskItem.style.borderLeft = `5px solid ${task.color}`;
        
                taskItem.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h2 class="font-bold text-xl mb-2 flex items-center">
                                ${task.title}
                                ${task.isRecommended ? '<span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded">🤖 AI Recommended</span>' : ''}
                            </h2>
                            <p class="text-gray-600 mb-2">${task.description || 'No description'}</p>
                            <div class="grid grid-cols-3 gap-4 mb-4">
                                <div class="bg-gray-50 p-2 rounded">
                                    <span class="text-sm text-gray-500">Priority</span>
                                    <p class="font-semibold ${getPriorityColor(task.priority)}">${task.priority || 'None'}</p>
                                </div>
                                <div class="bg-gray-50 p-2 rounded">
                                    <span class="text-sm text-gray-500">Due Date</span>
                                    <p class="font-semibold">${task.dueDate || 'No date'}</p>
                                </div>
                                <div class="bg-gray-50 p-2 rounded">
                                    <span class="text-sm text-gray-500">Difficulty</span>
                                    <p class="font-semibold">${getDifficultyStars(task.difficulty)}</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="editTask(${index})" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                                <i data-feather="edit-2" class="w-4 h-4"></i>
                            </button>
                            <button onclick="removeTask(${index})" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
                                <i data-feather="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                `;
        
                taskList.appendChild(taskItem);
            });
        
            feather.replace(); // Ensure feather icons are replaced
        }
        
        function editSubtask(taskIndex, subtaskIndex) {
            const subtask = tasks[taskIndex].subtasks[subtaskIndex];

            const dialog = document.createElement('div');
            dialog.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center';
            dialog.innerHTML = `
                <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full">
                    <h3 class="text-xl font-bold mb-4">Edit Subtask</h3>
                    <form id="editSubtaskForm" class="space-y-4">
                        <div>
                            <input type="text" id="editSubtaskTitle" value="${subtask.title}" required
                                class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="Subtask Title">
                        </div>
                        <div>
                            <textarea id="editSubtaskDesc" 
                                class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="Description">${subtask.description || ''}</textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <select id="editSubtaskPriority" class="w-full p-2 border rounded">
                                <option value="">Priority</option>
                                <option value="Low" ${subtask.priority === 'Low' ? 'selected' : ''}>Low</option>
                                <option value="Medium" ${subtask.priority === 'Medium' ? 'selected' : ''}>Medium</option>
                                <option value="High" ${subtask.priority === 'High' ? 'selected' : ''}>High</option>
                            </select>
                            <input type="text" id="editSubtaskDueDate" value="${subtask.dueDate || ''}" 
                                class="w-full p-2 border rounded subtask-due-date"
                                placeholder="Due Date">
                        </div>
                        <div class="flex justify-end space-x-2 mt-4">
                            <button type="button" onclick="this.closest('.fixed').remove()" 
                                class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
                            <button type="submit" 
                                class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Save Changes</button>
                        </div>
                    </form>
                </div>
            `;

            document.body.appendChild(dialog);

            flatpickr("#editSubtaskDueDate", {
                dateFormat: "Y-m-d",
                minDate: "today"
            });

            dialog.querySelector('#editSubtaskForm').addEventListener('submit', (e) => {
                e.preventDefault();

                tasks[taskIndex].subtasks[subtaskIndex] = {
                    ...subtask, 
                    title: document.getElementById('editSubtaskTitle').value,
                    description: document.getElementById('editSubtaskDesc').value,
                    priority: document.getElementById('editSubtaskPriority').value,
                    dueDate: document.getElementById('editSubtaskDueDate').value
                };

                localStorage.setItem('tasks', JSON.stringify(tasks));
                renderTasks();
                dialog.remove();
            });
        }
        function renderSubtasks(subtasks, taskIndex) {
            if (!subtasks.length) {
                return '<p class="text-gray-500 italic">No subtasks yet</p>';
            }

            return subtasks.map((subtask, subtaskIndex) => `
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <input type="checkbox" 
                                ${subtask.completed ? 'checked' : ''} 
                                onchange="toggleSubtask(${taskIndex}, ${subtaskIndex})"
                                class="form-checkbox h-5 w-5 text-blue-600">
                            <div class="${subtask.completed ? 'line-through text-gray-500' : ''}">
                                <h4 class="font-semibold">${subtask.title}</h4>
                                <p class="text-sm text-gray-600">${subtask.description || ''}</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-sm ${getPriorityColor(subtask.priority)}">${subtask.priority}</span>
                            <span class="text-sm">${subtask.dueDate || 'No date'}</span>
                            <button onclick="editSubtask(${taskIndex}, ${subtaskIndex})" 
                                class="text-blue-500 hover:text-blue-700">
                                <i data-feather="edit-2" class="w-4 h-4"></i>
                            </button>
                            <button onclick="removeSubtask(${taskIndex}, ${subtaskIndex})" 
                                class="text-red-500 hover:text-red-700">
                                <i data-feather="x" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function addSubtaskToTask(taskIndex) {
            const dialog = document.createElement('div');
            dialog.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center';
            dialog.innerHTML = `
                <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full">
                    <h3 class="text-xl font-bold mb-4">Add Subtask</h3>
                    <form id="subtaskForm" class="space-y-4">
                        <input type="text" placeholder="Subtask Title" required
                            class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <textarea placeholder="Description"
                            class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        <div class="grid grid-cols-2 gap-4">
                            <select class="w-full p-2 border rounded">
                                <option value="">Priority</option>
                                <option value="Low">Low</option>
                                <option value="Medium">Medium</option>
                                <option value="High">High</option>
                            </select>
                            <input type="text" placeholder="Due Date" class="subtask-due-date w-full p-2 border rounded">
                        </div>
                        <div class="flex justify-end space-x-2">
                            <button type="button" onclick="this.closest('.fixed').remove()" 
                                class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
                            <button type="submit" 
                                class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Add</button>
                        </div>
                    </form>
                </div>
            `;

            document.body.appendChild(dialog);

            flatpickr(".subtask-due-date", {
                dateFormat: "Y-m-d",
                minDate: "today"
            });

            dialog.querySelector('form').addEventListener('submit', (e) => {
                e.preventDefault();
                const form = e.target;
                const newSubtask = {
                    title: form.querySelector('input[type="text"]').value,
                    description: form.querySelector('textarea').value,
                    priority: form.querySelector('select').value,
                    dueDate: form.querySelector('.subtask-due-date').value,
                    completed: false
                };

                tasks[taskIndex].subtasks.push(newSubtask);
                localStorage.setItem('tasks', JSON.stringify(tasks));
                renderTasks();
                dialog.remove();
            });
        }

        function toggleSubtask(taskIndex, subtaskIndex) {
            tasks[taskIndex].subtasks[subtaskIndex].completed = !tasks[taskIndex].subtasks[subtaskIndex].completed;
            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderTasks();
        }

        function removeSubtask(taskIndex, subtaskIndex) {
            tasks[taskIndex].subtasks.splice(subtaskIndex, 1);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderTasks();
        }

        function getPriorityColor(priority) {
            switch(priority) {
                case 'High': return 'text-red-600';
                case 'Medium': return 'text-yellow-600';
                case 'Low': return 'text-green-600';
                default: return 'text-gray-600';
            }
        }

        function getDifficultyStars(difficulty) {
            const fullStar = '★';
            const emptyStar = '☆';
            const numDifficulty = parseInt(difficulty) || 0;
            return fullStar.repeat(numDifficulty) + emptyStar.repeat(5 - numDifficulty);
        }
        function setupAutoRefresh() {
            setInterval(renderTasks, 150);
        }
    </script>
</body>
</html>
